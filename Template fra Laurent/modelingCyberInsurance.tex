\chapter{Modeling Cyber-Insurance }
\label{chp:modelingCyberInsurance} 


\section{Network Formation Games}


In many scenarios agents seeks to create networks in order to directly benefit from each other. The established links might represent companies out sourcing part of their manufacturing, or cooperative agreements in the development of new software products. In addition to increase the trade-off, each of the established links represents risk of being a victim of cascading failures. The intuitive example is the spread of epidemic diseases, also node failures of a power grid and financial contagion such as the one back in 2008 was a result of cascading failures. Strategic network formation using cyber-insurance can be used to prevent such situation in addition to increase the overall payoff of participants in a clustered network.


When deciding whether to establish connection to a neighbor agent, the payoff has to be higher in the balance between the expected earnings and the risk of the other party failing to complete the transaction. This is the reason why we seek to only download content from trusted peers and outlaw MC-gangs are consistently skeptical to enter into new agreements despite promising increased earnings, since the risk of undercover police are too high. 


The paper \cite{contagion} come up with some interesting results regarding network formation games. 
They set up a game where the nodes benefit from direct links, but these links also expose them for risk. 
Each node gains a payoff of  $a$ per link it establishes, but it can establish a maximum of $\delta$ links.
A failure occur at a node with probability $q$, and propagates on a link with probability $p$. If a nodes fail, it will receive a negative payoff of $b$, no matter how many links it has established.

The results from their model shows a situation where clustered graphs achieve a higher payoff when connected to trusted agents, compared to when connecting with random nodes. Unlike in anonymous graphs, where nodes connect to each other at random, nodes in these graphs share some information with their neighbours, which is used when deciding whether to form a link or not. 
To further explain these results, they show that there exists a critical point, called \textit{phase transition}, which occurs when nodes have a node degree of $frac{1}{p}$. 
At this point a node gets a payoff of $frac{a}{p}$, and to further increase the payoff the node needs to go into a region with significantly higher failure probability. 
Because once each node establish more than $frac{1}{p}$ links, the contagious edges, will with high probability form a large cluster. Which results in a rise in probability of node failure, and reduces the overall welfare.
From this the paper say that when the minimum welfare exceeds 
$(1+f(\delta)*frac{a}{p})$
we have reached super critical payoff. Otherwise it is called sub-critical payoff. 
Further they show that the only possible way of ending up with supercritical payoff, is by forming clustered networks consisting of cliques with slightly more than $frac{1}{p}$ nodes. 
If the nodes form an anonymous market, random linking, they can only get sub-critical payoff. 
In other words, if the nodes can choose who they connect with, and by doing so, creating trusted clustered markets, they can achieve a higher payoff, by exceeding the critical node degree point. But in random graphs, this is not possible. 


Inspired by this model, we are step wise building a model which shields light on how cyber-insurance can be used in network formation to prevent cascading failures and increase an agents payoff.  


\section{Model 1 - Initial Model \label{section:verysimplemodel}}

As a starting point the model is highly simplified in order to show the concept of how cyber-insurance can be used to create an insurable topology. Through out this chapter new features will be added to the model to make it more realistic and applicable. To begin, the model is formulated as follows.
A set of $n$ agents are randomly chosen to be insured or not, as depicted in figure \ref{fig:firstmod1}. They all get their own fixed income, and by connecting to other agents they will receive a benefit resulting in higher payoff. Non-insured agents will have a risk of failure i.e. an expected cost of failure. Therefore if an insured agents chooses to connect to a non-insured agent they will also suffer from this expected cost of failure. To simplify the decision process, the model follows a rule that only allows insured to connect to other insured agents and non-insured agents can only connect with each other. In addition we apply the assumption that each node goes through the whole graph to decide whether to establish a connection or not. Since the decision is bidirectional, meaning each agent must agree to establish the connection, the resulting graph will always be two fully connected cliques, one consisting of insured agents and the other of non-insured agents, as shown in figure \ref{fig:firstmod2}. 


This dichotomy represents a trusted environment for the insured nodes, because they know that each node in the clique is insured against risk such as, financial catastrophe. These agents will benefit from each connection without having to worry about contagious risks from the connected agents. 
An agent in the non-insured clique will also receive the aggregated benefits from the connections, however each of the connection has a probability of failure. Hence this environment is not trusted, and a decision on whether to connect will always involve some risk. 

\begin{figure}[h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.4\linewidth]{../Figures/firstModelWithNoParameters1.png}
  \caption{\label{fig:firstmod1} 15 Agents randomly choosen to be either insured (green) or non-insured (red).}
\end{subfigure}
\quad
\begin{subfigure}{.46\textwidth}
  \centering
  \includegraphics[width=0.8\linewidth]{../Figures/firstModelWithNoParameters2.png}
  \caption{\label{fig:firstmod2} Two clustered networks. One consisting of insured agents the other consists of non-insured.}
\end{subfigure}
\caption{\label{fig:firstmodfinal} Shows how agents connects to eachother according to model described in section \ref{section:verysimplemodel}.}
\end{figure}


There are many examples of nodes needing to establish connections, one example is a company needing to out-source certain tasks to remain competitive. This outsourcing involves some risks, such as, will the company deliver at the reported time, to the reported costs, what happens if they fail to deliver, what if they go bankrupt etc. If the companies that are going to establish links(cooperative contracts), know that the other firms are insured, it will be more secure and reliable to enter into an cooperative agreement. In this way trusted cliques can evolve. The firms benefit from connecting to other insured firms, and the insurance company can offer fair prices to the insured companies, because the risk is low trusted clique.
Hence this model, although very simple, shows an insurable topology where insured agents benefit from being insured. 


This model is very simplified and suffer from many limitations, among others it is too simple to reflect the dynamics of a real world scenario, where each node will have different variables with different values. Although it tries to deal with the problem of correlated risks and preventing free riders from entering the trusted clique (interdependent security problem), each node have a complete network information i.e. the problem with information asymmetry is not taken into account. 

\section{Model 2 - Including Parameters}
To make the simple model more realistic, we have to create a game with parameters, that reflects some real world scenarios. The characteristics of the game is as follows: The type of the nodes are given in advance, i.e. they are chosen to be insured or non-insured. The insured nodes have to pay an insurance cost $I_{0}$, which represents the cost of signing a contract with an insurance company. I.e this could be an actual fee or a cost reflecting the work a player has to do to get a contract. For each link a node establish they receive a payoff of $\beta$. This represents the positive network externalities of the game. An insured node has to pay a cost of $I_{l}$ for every link he establishes. The game is bidirectional, i.e. both nodes need to agree of the establishment of a link, and if both are insured, they both have to pay the cost $I_{l}$. 
Every agent who is not insured will have a risk of failure(infection, bankruptcy, or some other type of failure), this is captured with the expected risk cost $r$. Every node, insured or not who connects to a non-insured node will also suffer from this cost. The link insurance cost and the risk are negative network externalities in the game. Table \ref{tbl:simplegamepara} presents an overview of the parameters. 
\begin{table}[h]
\centering
\begin{tabular}{lc}
 \hline
  $\beta$ - income from establishing a direct link \\
  $I_{o}$ - cost of having insurance. \\
  $I_{l}$ - increased insurance cost per link the node establishes\\
  $r$ - expected risk cost\\
  \hline
\end{tabular}
\caption{Table showing the parameters to be used in the first model \label{tbl:simplegamepara}}
\end{table}
\subparagraph{Two agent game}
To begin analyzing the game, lets consider a two-person game. In this game the strategy space of both players consist of four different strategies. A node can be insured or not, and choose whether to establish a connection to the other player. I.e. the different strategies are: Be insured and establish link noted as: $IL$, 
be insured and not establish link: $I\overline{L}$. Not insured and establish link: $\overline{I}L$, and not insured and not establish link: $\overline{IL}$. It should be noted that since the decision to establish a connection is bidirectional, both have to choose a strategy where they want to establish a link, for the link to be establishment to be successful.
Figure \ref{fig:FirstGameTheoryModel} shows the different outcomes of this game.

\begin{sidewaysfigure} % <-- HERE
\centering
\includegraphics[width=1.0\textwidth]{../Figures/FirstGameWithParameters.png}
\caption{\label{fig:FirstGameTheoryModel} Normal form game, showing the different strategies and the payoffs  for the different outcomes. The payoff for agent A is written first, then the payoff for agent B is on the line beneath.
 An agent has a strategy space of size 4. Maa ENDRES...}

\end{sidewaysfigure}


From the payoff matrix we can derive a single Nash equilibrium, namely for both players to play $\overline{I}L$. If we first look at firm A, we see that when firm B chooses $IL$, the best response is $\overline{I}L$, because $ \beta - I_{l} < \beta$. When firm B chooses $\overline{I}L$, the best response will again be $\overline{I}L$, because $\beta - I_{l} - r < \beta - r $. 
The exact same results yields for firm B, hence the best response will allways be $\overline{I}L$. 
This means that two nodes will end up in a classic prisoner's dilemma\footnote{Prisoner's dilemma was originally framed by Merrill Flood and Melvin Dresher in 1950. The dilemma expresses a situation where two players each have two options whose output depends on the simultaneous choice made by the other. In the original dilemma concerns two prisoners which separately decides whether to confess to a crime \cite{oxfordPrisonersDilemma}. It is a paradox in decision analysis which shows why two individuals might not cooperate, even if it is in their best interest to do so.}, where the best response is actually worse than the social optimal. In this case it is trivial to see that the social optimal scenario is for both nodes to choose $IL$. The reason for why we end up in $\overline{I}L$ is logical, since we assume either of the players have information about what decision the other will make. Therefore they assume the worst case, that the other node chooses not to buy insurance. Else they could risk ending up in a case where they pay $I_{l}$ without receiving any other benefit. 
  
  
  ..prisoner dilema, hvorfor havner vi her(vet ikke hva den andre gjoer, tar en safe vei) 
  ..løsning stackeshit
  ..videre antar vi at netverket er gitt, altsaa gitt noder og tilstand, som vil si at vi ikke vil ende opp i ikke insure-link
  
....SLETTE DETTE NEDENFOR?!?!  
do this we have to analyze the different scenarios. 
When non-insured nodes connect to each other, they both end up with the payoff shown in Eq. (\ref{eq:notinsured payoff}). If they do not establish connection, they both receive the payoff shown in Eq. (\ref{eq:notinsured payoff2}).
\begin{equation}
U=- 2*r +\beta
\label{eq:notinsured payoff}
\end{equation}

\begin{equation}
U=- r
\label{eq:notinsured payoff2}
\end{equation}

From this equation we see that if $r>\beta$ then no connections will be made between non-insured nodes, because they would strictly prefer the payoff from not connecting.
If an insured node connects to a non-insured one, he will end up with the payoff in Eq. (\ref{eq:insured-noninsured0}). If he do not connect he will receive the payoff shown in Eq. (\ref{eq:insured-noninsured2}).

\begin{equation}
U= - I_{0} - I_{l} - r + \beta
\label{eq:insured-noninsured0}
\end{equation}

\begin{equation}
U= - I_{0}
\label{eq:insured-noninsured2}
\end{equation}

If $I_{l}+r>\beta$ the insured one will prefer not to connect, else he would prefer to establish a connection, and since the non-insured agent is always better off when connected to an insured agent, he will accept the establishment. This can be shown when comparing the two payoffs. Payoff of connecting to an insured one: $U_{i}=- r + \beta$ is allways higher than not connecting: $U_{i}= - r$, as long as $\beta>0$.


.... UNDER HER ER TING GREIT. 

\input{stackelberg}

\subsection{Multiple nodes}
Making the model more realistic we expanded it to apply to multiple nodes. Our goal is to find characteristic network formations that will evolve at certain conditions. 
\subparagraph{Insured to insured}
When an insured node are considering establishing a link to another insured node, they will do so if both receive a higher payoff. Let $U_{i}$ denote the payoff of a node with degree $i$. When a insured node consider adding a link the payoff function is as shown in Eq. (\ref{eq:itoimodel2}).
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \beta - I_{0} - I_{l},& \text{if } i = 0\\
    U_{i}+\beta -I_{l},& \text{if }  i>0
   
\end{cases}
\label{eq:itoimodel2}
\end{equation}
For insured node to connect to another insured node, $U_{i+1}\geq U_{i}$. For this to be true we get the condition shown in Eq. (\ref{eq:itoi-condition}).
\begin{equation}
I_{l}>\beta
\label{eq:itoi-condition}
\end{equation}
\subparagraph{Insured connect to non-insured}
The payoff a insured node receives in this scenario is as follows:
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \beta - I_{0} - I_{l}-r,& \text{if } i = 0\\
    U_{i}+\beta -I_{l}-r,& \text{if }  i>0
   
\end{cases}
\label{eq:itonotimodel2}
\end{equation}
For this to happen Eq. (\ref{eq:itonoti-condition}) has to hold, a non-insured node will allways want to connect to a insured one, so this is the only condition that is needed for this to happen.
\begin{equation}
I_{l}+r<\beta
\label{eq:itonoti-condition}
\end{equation}
\subparagraph{Non-insured to Non-insured}
They payoff a non-insured nodes receives when connecting to another non-insured node is as follows:
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \beta -r -r,& \text{if } i = 0\\
    U_{i}+\beta -r,& \text{if }  i>0
   
\end{cases}
\label{eq:notitonotimodel2}
\end{equation}
And for this link-establishment scenario to happen Eq. (\ref{eq:notitonoti-condition} has to hold.

\begin{equation}
\beta>r
\label{eq:notitonoti-condition}
\end{equation}

We want to find out when we will get a clique of only insured nodes.
To achieve this we need to make sure that only insured nodes connect to each other, we want Eq. (\ref{eq:itoi-condition}), because then we know that insured nodes will connect to each other. But we also need to ensure that insured nodes do not establish connections to non-insured nodes. I.e. this has to hold:
\begin{equation}
I_{l}+r>\beta
\end{equation}
This gives us this limitation on the parameter $I_{l}$:
\begin{equation}
\beta-r<I_{l}<\beta
\label{eq:final condition}
\end{equation}
If the condition is fulfilled the game will end up with a clique of only insured nodes, and another clique of non-insured nodes if: $\beta>r$. 

In this model the network formation is done endogenously, and when following the limitation \ref{eq:final condition} we ensure that only insured nodes will connect, and the network ends up in a insurable network topology. 
In this model we assume that every node has complete information of the network, i.e. every node knows the type of the other players. This is a very strong assumption, however in financial transactions and in software development networks, it is reasonable to assume that the parties can acquire this type of information regarding their transactional partners. For example by requiring proof of insurance prior to establishing a connection. 
As shown, if the insurance cost is within its needed limitations, the network will evolve endogenously, and end up with an insurable-clustered component, which is beneficial for both the insurer and the nodes.
These findings is independent of number of players, because we only consider one link at a time, and the change in payoffs is linear an independent of the nodes degree.


\subsection{Example - meeting the conditions}
By assigning values to the variables, we can show the outcome of the game in different scenarios. With the values from table \ref{tbl:simplegamevalue}, the insurance cost of establishing a link satisfies the condition in equation \ref{eq:final condition}.
If we play this game between two agents we can see the result in figure \ref{fig:NFnumbers}. 
The results are as we expected, insured nodes will only connect with other insured nodes, they are also satisfied when not connected to each other. However, this is not the social optimal outcome, and since they have complete network information, they will choose to connect to each other, because they will both achieve a higher payoff.


\begin{table}[h]
\centering
\begin{tabular}{lc}
 \hline
  $\beta=10,
  I_{o}=5,
  I_{l}=3,
  r=8$\\
  \hline
\end{tabular}
\caption{Table showing the parameters and their assigned values \label{tbl:simplegamevalue}}
\end{table}

\begin{figure}[h]
\centering
\begin{tabular}{@{}c@{}}
\includegraphics[width=1.0\textwidth]{../Figures/gameTheoryModel1WithNumbers.png}
\end{tabular}
\caption[Caption for LOF]{Normal form game between two agents with the parameters given in \ref{tbl:simplegamevalue}, the best response of a player to a given strategy is marked with an underscore.There are two pure nash equilibriums in this game,$IL,IL$ and $I\overline{L},I\overline{L}$. \label{fig:NFnumbers}}
\end{figure}

\subsection{Scenario - violating the conditions}
When setting the insurance cost such that: $I_{l}<\beta - r$ and/or $I_{l}>\beta$ we are violating the condition who ensured that only insured nodes connected to each other. In table \ref{tbl:simplegamevalue2} we let the insurance cost be: $I_{l}<\beta - r$, this results in the payoff matrix shown in figure \ref{fig:NFnumbersViolating}. There are still the same nash equilibriums, but the interesting part is the best response of an insured agent who want to establish link, when the other agent is not insured but also want to establish link. This scenario has now changed, and we see that the insured agent would agree to the link establishment, this will result in an untrusted and thus an non-insurable topology. A game with multiple nodes, insured and non-insured, will end up in one fully connected network.
On the other hand, if $I_{l}>\beta$, then it is easily seen that only the non-insured will connect to each other, and the insured nodes will not choose to connect to anyone because it is to expensive.
 Therefore to ensure that only insured agents connect to each other, equation \ref{eq:final condition} has to be satisfied. 
\begin{table}[h]
\centering
\begin{tabular}{lc}
 \hline
  $\beta=10,
  I_{o}=5,
  I_{l}=1,
  r=8$\\
  \hline
\end{tabular}
\caption{Table showing the parameters and their assigned values, the insurance cost of establishing link is now violating the equation \ref{eq:final condition} \label{tbl:simplegamevalue2}}
\end{table}

\begin{figure}[h]
\centering
\begin{tabular}{@{}c@{}}
\includegraphics[width=1.0\textwidth]{../Figures/NotOptimalGameWithNumbers.png}
\end{tabular}
\caption[Caption for LOF]{Normal form game between two agents with the parameters given in table \ref{tbl:simplegamevalue2}, the best response of a player to a given strategy is marked with an underscore.There are two pure nash equilibriums in this game,$IL,IL$ and $I\underline{L},I\underline{L}$. \label{fig:NFnumbersViolating}}
\end{figure}


\section{Simulating Model 2}
To verify the result of this network formation game with multiple nodes, we performed different simulations. The network formation is performed by selecting two random nodes, not neighbouring each other, then both nodes checks whether they would prefer to establish a connection or not. The rules are as described earlier, when a node is considering establishing a link it chooses to do so if the payoff received is larger than the payoff he already poses, and the decision is bilateral. 
In the simulator a node is insured with a probability, $p$. This selection is repeated until the network are fully connected or no more nodes are willing to establish new connections.
By selecting nodes at random and checking if both of them would like to connect to each other, we relax the assumption of full network information, because now nodes only get to know if another node is insured or not, by asking them.

\subparagraph{Simulation of game with optimal parameters}
\begin{figure}[h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.4\linewidth]{../Figures/FirstSimulationStart.png}
  \caption{\label{fig:firstsimulationstart} Ten nodes randomly, with probability 0.5, chosen to be either insured (green) or non-insured (red.}
\end{subfigure}
\quad
\begin{subfigure}{.46\textwidth}
  \centering
  \includegraphics[width=0.8\linewidth]{../Figures/FirstSimulationResult.png}
  \caption{\label{fig:firstsimulationresult} Two clustered fully connected networks. One consisting of insured agents the other consists of non-insured. The link establishment is done by following the rules described above}
\end{subfigure}
\caption{\label{fig:firstsimulation} The figure shows how ten nodes start out with no links, and then add links as long as they can increase their payoff, the result are two seperate cliques, one consisting of non-insured and the other of insured nodes.}
\end{figure}
In figure \ref{fig:firstsimulation} we see the result of a simulation with the parameters from table \ref{tbl:simplegamevalue}. Since these parameter values holds for the condition \ref{eq:final condition}, the game should end up in two cliques, one with insured nodes and another with non-insured. The result are shown in figure \ref{fig:firstsimulationresult}, and confirms our calculations where only insured nodes connect to each other.  
In this figure there are only included $n=10$ nodes, this is done to make the figure readable and easy to understand.
The same results where obtained when performing the simulation with larger values of n, however the resulting printouts was very complex and chaotic.


\subparagraph{Simulation of game with parameters violating equation \ref{eq:final condition}}
\begin{figure}[h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
\includegraphics[width=0.4\linewidth]{../Figures/FirstSimulationViolatingResult.png}

\caption{\label{fig:SimulationViolatingA} Ten nodes insured with probability 0.5, and the parameters from table \ref{tbl:simplegamevalue2}. The link insurance cost, $I_{l}$, is violating the condition in equation \ref{eq:final condition}, and the resulting network is one clique of both insured and non-insured nodes.}
\end{subfigure}
\quad
\begin{subfigure}{0.46\textwidth}
\centering
\includegraphics[width=0.4\textwidth]{../Figures/SimulationViolating2.png}

\caption{\label{fig:SimulationViolatingB} Ten nodes insured with probability 0.5, with parameters from table \ref{tbl:simplegamevalue2}, except that the link insurance cost was:, $I_{l}=11>\beta$. This resulted in a clique of only non-insured nodes. }
\end{subfigure}
\caption{\label{fig:SimulationViolating} The figure shows the two possible scenarios that violates the equation \ref{eq:final condition}, \ref{fig:SimulationViolatingA} shows the result when $I_{l}<\beta-r$ and \ref{fig:SimulationViolatingB} shows the result when $I_{l}>\beta$.}
\end{figure}

In this simulation, the cost of insuring a link where violating the equation \ref{eq:final condition}. The result can be seen in figure \ref{fig:SimulationViolating}.  In figure \ref{fig:SimulationViolatingA} we see the result when $I_{l}<\beta-r$, the result is one clique of both insured and non-insured nodes. In figure \ref{fig:SimulationViolatingB} the insurance cost is $I_{l}>\beta$, and as we see only non-insured nodes connect to each other, because the insurance cost per link cost more than the benefit given from connecting to a new node, i.e. the insured ones choose not to establish any connections. 




\section{Model 3 - Including maximum node degree and bonus}
We keep adding new features to the model, here we introduce a maximum node degree per node, and a payoff bonus when reaching this level. This is done to make a more applicable model in certain scenarios. For example, lets consider a software company who want to develop a new product. However, they do not have the required resources or knowledge to complete the product, and will therefore need help from other companies with the desired knowledge or resources. When the product is finished the company get paid, but not before, to finish the product they need to cooperate with others.
To model this scenario we added a bonus $\gamma$, which represents the payoff when a node reach their desired number off established connections, i.e. their maximum node degree($m$). Except from this fact the game is as before, nodes connect to other nodes if they can reach a higher payoff by doing so. 



\subsubsection{Four different scenarios}
To further analyze this model, lets take a closer look on the four different scenarios of the game, a insured node wants to connect to another insured node, insured tries to connect to a non-insured node, non-insured tries to connect to another non-insured node, and non-insured who tries to connect to a insured node.
\subparagraph{Insured to insured}
When an insured node tries to connect to another insured node, the node decision depends on whether he can increase his payoff. 
Let $U_{i}$ denote the payoff of a node with node-degree $i$. When adding a link the payoff the node receives is as follows:
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \alpha + \beta - I_{0} - I_{l},& \text{if } i = 0\\
    U_{i}+\beta -I_{l},& \text{if }  i>0\\
    U_{i}+\beta -I_{l}+\gamma,& \text{if } i=m
    
\end{cases}
\label{eq:itoi}
\end{equation}
For insured nodes to connect to each other, $U_{i+1} > U_{i}$. This model is very similar to the earlier model, but we need to consider the received bonus when reaching the maximum node degree, $m$.
We model this by adding, the bonus divided on the current degree, in the decision process of establishing link or not. 
\begin{eqnarray}
U_{i}+\beta-I_{l}+\frac{\gamma}{m-i}&>U_{i} \nonumber \\ 
\beta-I_{l}+\frac{\gamma}{m-i}&>0 \nonumber \\ 
\llap{$\rightarrow$\hspace{50pt}} \beta+\frac{\gamma}{m-i}&>I_{l} 
\label{eq:itoi2}
\end{eqnarray}
It should be noted that the actual bonus is not added to the current payoff before the node reach the maximum degree, as shown in equation \ref{eq:itoi}. The equation $\frac{\gamma}{ m-i}$ reflects the expected payoff from taking the risk of establishing a connection. This value increases linearly according to how close you are to reach $m$.
In this way the model will change from the former models, because now the nodes have more incentive to connect to other nodes, and in some scenarios they will be willing to take the risk of connecting to a non-insured node in order to reach the expected bonus. The model now introduces a risk factor, because it is not certain that the nodes will obtain enough links, and if not, they will not receive their bonus, however they are stuck with the established connections. 

\subparagraph{Insured connect to non-insured}
The payoff an insured node receives in this scenario is as follows:
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \alpha + \beta - I_{0} - I_{l} -r,& \text{if } i = 0\\
    U_{i}+\beta -I_{l}-r,& \text{if }  i>0\\
    U_{i}+\beta -I_{l}-r+\gamma,& \text{if } i=m
\end{cases}
\label{eq:itonoti}
\end{equation}
To establish a connection from an insured node to a non-insured one, the following has to hold:
\begin{eqnarray}
U_{i}+\beta-I_{l}-r+\frac{\gamma}{m-i}&>U_{i} \nonumber \\ 
\beta-I_{l}-r+\frac{\gamma}{m-i}&>0 \nonumber \\ 
\llap{$\rightarrow$\hspace{50pt}} \beta+\frac{\gamma}{m-i}-r&>I_{l} 
\end{eqnarray}
\subparagraph{Non-insured to non-insured}
When a non-insured node connect to another not-insured node this is the payoff they receive:
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \alpha + \beta -r,& \text{if } i = 0\\
    U_{i}+\beta -r,& \text{if }  i>0\\
    U_{i}+\beta -r +\gamma,& \text{if } i=m
\end{cases}
\label{eq:noitonoti}
\end{equation}
To establish the connection this equation has to hold:
\begin{eqnarray}
U_{i}+\beta-r+\frac{\gamma}{m-i}&>U_{i} \nonumber \\ 
\beta-r+\frac{\gamma}{m-i}&>0 \nonumber \\ 
\llap{$\rightarrow$\hspace{50pt}} \beta+\frac{\gamma}{m-i}&>r
\end{eqnarray}
\subparagraph{Non-insured to insured}
\begin{equation}
    U_{i+1}= 
\begin{cases}
    \alpha + \beta,& \text{if } i = 0\\
    U_{i}+\beta,& \text{if }  i>0\\
    U_{i}+\beta +\gamma,& \text{if } i=m
\end{cases}
\label{eq:noitoti}
\end{equation}
As we see, this is a strictly increasing function, and thus a non-insured will always connect to an insured node if given the option, and as long as $\beta$ is positive, which it is, given the rules of the model.

\subparagraph{Limitations to ensure a clique of only insured}
We are interested in finding insurable topologies, one candidate is a sub graph consisting of only insured nodes. By analyzing the different scenarios above we can find limitations on the cost of insuring a link, that will force the network formation game to end up in an insurable sub graph.
We know that an insured node would want to connect to another insured node if the equation \ref{eq:itoi2} is satisfied. 
In the equation we see that the expected bonus per established link is increasing, i.e. if an insured node of degree zero is willing to connect to another insured node, then every node with a degree higher than zero also would like to connect to another insured node. Thus to ensure that insured nodes connect to each other this equation has to hold:
\begin{equation}
\beta+\frac{\gamma}{m}>I_{l}
\label{eq:conditionitoi}
\end{equation}
We also want to ensure that insured nodes never establishes links with non-insured nodes, from \ref{eq:itonoti} we see that this has to hold:
\begin{equation}
\beta+\frac{\gamma}{m-i}-r < I_{l}
\label{eq:conditionitonoti}
\end{equation}
This can be simplified, since we know the insured nodes with degree $m-1$ get the highest expected bonus when establishing a new link, i.e. if we can ensure that nodes with this degree do not establish links to non-insured nodes, we also know that every node with degree less than $m-1$ will not establish links to non-insured nodes. From this we get the equation:
\begin{eqnarray}
\beta+\frac{\gamma}{m-(m-1)}-r&<I_{l} \nonumber\\
\llap{$\rightarrow$\hspace{50pt}} \beta+\gamma-r&<I_{l}
\label{eq:condition-i-to-noti}
\end{eqnarray}
To summarize, the equations \ref{eq:conditionitoi} and \ref{eq:conditionitonoti} gives the final limitation on the link insurance cost:
\begin{equation}
\beta+\gamma-r<I_{l}<\beta+\frac{\gamma}{m}
\label{eq:final-insurance-clique-condition}
\end{equation}
Additionally, in order to make it possible for the game to end up in an insurable topology equation \ref{eq:noinsuredcliqueconditon} has to be satisfied. As we see from the equation, if the risk to bonus ratio gets to small it gets more and more unlikely to ensure an insurable topology. If we think about a real world scenario where you get a bonus for establishing a fixed number of equations, you would be more willing to take a risk if the possible reward of doing so is large, this is what this equation express. 
\begin{eqnarray}
\gamma-r &<\frac{\gamma}{m}\nonumber \\
1-\frac{r}{\gamma}&<\frac{1}{m} \nonumber \\
\llap{$\rightarrow$\hspace{50pt}}1-\frac{1}{m}&<\frac{r}{\gamma}
\label{eq:noinsuredcliqueconditon}
\end{eqnarray}

\subsection{Simulations}
We simulate how networks form when the conditions from equation \ref{eq:final-insurance-clique-condition} are met, and what happens when they are not. In addition we use the simulation to look at the consequences with regards to the payoff, when the required number of connections aren't met. 

\subparagraph{Simulation when conditions are met}
First we simulate a network formation game when the link insurance cost satisfied the equation \ref{eq:final-insurance-clique-condition}, using the parameters in table \ref{tbl:maxdegrevalues}. 
\begin{table}[h]
\centering
\begin{tabular}{lc}
 \hline
  $\alpha=10,
  \beta=10,
  I_{o}=5,
  I_{l}=9,
  r=8,
  \gamma=5,
  m=5
  $
  \\
  \hline
\end{tabular}
\caption{Parameters used in the simulation \label{tbl:maxdegrevalues}}
\end{table}
\begin{figure}[h]
\centering
  \includegraphics[width=0.8\linewidth]{../Figures/BonusGameInsuredClique.png}
  \caption{\label{fig:bonusoptimal} Two clustered fully connected networks, created by simulating with the parameters from table \ref{tbl:maxdegrevalues} One consisting of insured agents the other consists of non-insured. }
\end{figure}
As we see in figure \ref{fig:bonusoptimal} the results where as expected, the cost of insuring a link satisfied the conditions found earlier and thus the result where two cliques, one consisting of only insured and the other of non-insured nodes.

\subparagraph{Simulation when the parameters violates the conditions}
If we change the link insurance cost, so it is just below the limit, $I_{l}=6$, the result is quite different as depicted in figure \ref{fig:bonusviolating}. Here we see that eventhough non-insured nodes can fail and accumulate negative payoff, some of the insured nodes have taken a risk by connecting to non-insured nodes in order to receive the bonus. 

\begin{figure}[h]
\centering
  \includegraphics[width=0.8\linewidth]{../Figures/BonusGameViolating.png}
  \caption{\label{fig:bonusviolating} Simulation when the cost of insuring a link is just below the limits. }
\end{figure}


\subparagraph{Consequences of not reaching required number of edges}
Both of these scenarios ends up in a situation where the nodes reach their maximum node degree and they all receive the bonus. However each time a node chooses to connect to another node, except when $i=m-1$, it does not know whether it will reach the maximum node degree. Hence the node might take a risk of connecting to other nodes without being able to reach their required number of connections. This means that in certain situation one might end up getting a total $i<m$ connections which results in a much lower payoff than expected. If the variables are set close to a worst-case, such as in table \ref{tbl:maxdegrevalueswitherror} , we end up with two cliques with payoffs close too or worse than the payoff each node had initially. 

\begin{table}[h]
\centering
\begin{tabular}{lc}
 \hline
  $\alpha=10,
  \beta=10,
  I_{o}=5,
  I_{l}=11,
  r=8,
  \gamma=25,
  m=11
  $
  \\
  \hline
\end{tabular}
\caption{Parameters used in simulation \label{tbl:maxdegrevalueswitherror}}
\end{table}


\begin{figure}[h]
\centering
  \includegraphics[width=1.0\linewidth]{../Figures/payoffWhenFulfillingAndViolatingConditionsInMaxDegreeSimulation.png}
  \caption{\label{fig:payoffMaxDegreeSimulation} The different payoffs received when fulfilling and violating the conditions given in \ref{eq:final-insurance-clique-condition}, using the parameters from table \ref{tbl:maxdegrevalues} and \ref{tbl:maxdegrevalueswitherror}. }
\end{figure}

As depicted in figure \ref{fig:payoffMaxDegreeSimulation}, with the variables from table \ref{tbl:maxdegrevalueswitherror} the resulting payoffs from figure \ref{fig:bonusviolatingWithErrors} equals $6$ for each of the non-insured nodes and $-1$ for the insured nodes. In comparison, the same figure using the variables from table \ref{tbl:maxdegrevalues} results in a positive payoff $15$ for each of the nodes in the insured clique. This comparison shows the consequences of failing to achieve the required amount of connections, which might be the case if a company is trying to complete a project which requires too many external suppliers. 

\begin{figure}[h]
\centering
  \includegraphics[width=0.6\linewidth]{../Figures/BonusGameInsuredCliqueWithErrors.png}
  \caption{\label{fig:bonusviolatingWithErrors} Simulation when the cost of insuring a link is just below the limits and the maximum node degree is high. }
\end{figure}

\section{Model 4 - Including bulk insurance discount}

Insurance companies often interpret a quantum discount when purchasing multiple products. From convenience stores we are used to the slogan "buy one get one for free". It seems to be common for insurance companies to offer discount to their customers if they choose to collect some or all of their insurances with them. Several insurance companies in Norway, such as Sparebank 1 offers customers up to 25 $\%$ discount according to the following rules \cite{sparebank1}. 

\begin{itemize}

\item 10$\%$ discount if the person has signed three different insurances
\item 15$\%$ discount if the person has signed four different insurances
\item 20$\%$ discount if the person has signed five or more different insurances
\item Plus additional 5$\%$ discount if the person is a customer of the bank. 

\end{itemize}

The insurance offered is intended to the individual market and includes among others: travel insurance, household insurance, car insurance, house insurance, insurance of valuable items and yacht insurance. Since this seems to be the trend for marketing insurance products, it is reasonable to believe that several bonus options would be included in a cyber-insurance product. Since our model so far reflects that a company have to insure each of the connections to other nodes in their network, it is assumed that a similar discount rate following the number of established would be implemented. 

How insurance companies choose to formulate their discount rate might vary. One solution might be to follow a strict 5$\%$ discount per new connection, similar to the one from Sparebank 1, or let the discount follow a power law. However, we choose to follow a discount rule which directly reflects the number of connections the company have established. 
The price for adding a new connection follows the equation:

\begin{equation}
\frac{I_{l}}{i+1}
\label{eq:discount0}
\end{equation}

Here, $i$ is the current number of established connections. This means that the more connections a company acquire the cheaper the connections will be. 
If we add the new rule to the equation \ref{eq:itoi} which shows the connection between two insured nodes, we get the following equations: 

\begin{equation}
    U_{i+1}= 
\begin{cases}
    \alpha + \beta - I_{0} - I_{l},& \text{if } i = 0\\
    U_{i}+\beta -\frac{I_{l}}{i+1},& \text{if }  i>0\\
    U_{i}+\beta -\frac{I_{l}}{i+1}+\gamma,& \text{if } i=m
    
\end{cases}
\label{eq:discount1}
\end{equation}

As described, for insured nodes to connect to each other, $U_{i+1} > U_{i}$. Building on the already existing model, the quantum discount slightly changes the decision process:
\begin{eqnarray}
U_{i}+\beta-\frac{I_{l}}{i+1}+\frac{\gamma}{m-i}&>U_{i} \nonumber \\ 
\beta-\frac{I_{l}}{i+1}+\frac{\gamma}{m-i}&>0 \nonumber \\ 
\beta (i+1)+\frac{\gamma}{m-i}&>\frac{I_{l}}{i+1} \nonumber \\
\llap{$\rightarrow$\hspace{50pt}}  \beta (i+1)+\frac{\gamma (i+1)}{m-i}&>I_{l}
\label{eq:discount2}
\end{eqnarray}

Similar calculation can be done for the other three scenarios in the game, and they all result in almost the same outcome. First of all results from having quantum discounts on new connections results in a overall higher payoff for the nodes, as long as $i>1$. Since the cost of insuring a new link becomes cheaper. This means that the nodes will have a higher incentive to create links to each other, because the left side of equation \ref{eq:discount2} yields a higher payoff than before. Which leads to a consequence that more insured nodes could connect to non-insured nodes. 
Building on the final condition \ref{eq:final-insurance-clique-condition} in previous section, we now get:

\begin{eqnarray}
\beta+\gamma-r<\frac{I_{l}}{i+1}<\beta+\frac{\gamma}{m} \nonumber \\
\beta(i+1)+\gamma(i+1)-r(i+1)<I_{l}<\beta(i+1)+\frac{\gamma(i+1)}{m}
\label{eq:final-insurance-clique-condition-with-discount}
\end{eqnarray}


From equation \ref{eq:final-insurance-clique-condition-with-discount} we see that the initial variable $I_(l)$ has to be priced higher, in order to ensure that only insured nodes connects to other insured nodes. However, beside this drawback, we also experience some positive effects from the modification, since the the purchase of more connections is cheaper the product might be more attractive for potential customers. 
\input{modelingWithNature}



\input{modelingCyberInsurance2(furtherWork)}


\
\
......FROM HERE, it's only notes.......
\section{DETTE ET ANNET STED KANSKJE? BLIR LITT RART Å HOPPE INN I DET HER}
By adjusting the parameter one can assure that only insured agents connects to other insured agents, and the opposite,
that only uninsured agents connects to each other. Hence as we can see from the figure \ref{fig:fincont} clustered
networks of insured agents (red) are created, and  as the paper \cite{contagion} showed, these clustered trusted
networks, can achieve higher, super-critical, payoff by increasing their node degree past the critical point.

\begin{figure}[h]
\centering
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=0.8\linewidth]{../Figures/financialContagion1.png}
  \caption{\label{fig:fincont1} Initial graph with 10 agents.}
\end{subfigure}
\quad
\begin{subfigure}{.46\textwidth}
  \centering
  \includegraphics[width=0.8\linewidth]{../Figures/financialContagion2.png}
  \caption{\label{fig:fincont2} Insured agents (red) forms a network}
\end{subfigure}
\caption{\label{fig:fincont} shows how insured agents connects with each other to form a network to achieve super-critical payoffs.}
\end{figure}

, because the nodes can thus receive a super-critical payoff, and they are also insured against contagious risk.  

Figure \ref{fig:GTmodel1equations} presents the individual payoffs in a formation game between two agents in the described model. It is assumed that both agents has to have a desire to establish a connection in order to create a link between them. This is reasonable since a company would not prefer to enter into an agreement with negative expected payoff. As in this case would be the result when an insured agent is requested a connection with someone without insurance. 
 
 
\begin{figure}[h]
\centering
\begin{tabular}{@{}c@{}}
\includegraphics[width=1.0\textwidth]{../Figures/gameTheoryModel1WithEquations.png}
\end{tabular}
\caption[Caption for LOF]{\label{fig:GTmodel1equations} Normal form game between two agents individually choosing to purchase insurance and express desire to connect to the other  \footnotemark }
\end{figure}
\footnotetext{A link will only be created if both agents wishes to establish a connection.}

If we give value to the variables in figure \ref{fig:GTmodel1equations} one can observe the model's different equilibrium's. It is difficult to know exactly how the variables are set and this would vary considerably between different markets. In a real worlds scenario the variables would also be different for each agent. However in figure \ref{fig:GTmodel1} we decided to set a fixed value (which is assumed to be corresponding to the real values) for each variable in order to show a concept of how cyber-insurance can be used to create beneficial payoffs.
The following values where used: $\alpha$ = 10, $\beta$ = 10, $I_{o}$ = 5, $I_{l}$ = 2, $r$  = 20, $q$ = 0.5.


\begin{figure}[h]
\centering
\begin{tabular}{@{}c@{}}
\includegraphics[width=0.6\textwidth]{../Figures/gameTheoryModel1WithNumbers.png}
\end{tabular}
\caption{\label{fig:GTmodel1} Shows equilibrium's in the resulting payoff matrix.}
\end{figure}

From the payoff matrix \ref{fig:GTmodel1} we observe two different Nash equilibrium's: One when both agents are insured and wants to connect to the other agent, and one when both are insured but does not want to establish a connection. These are the possible outcomes between the two agents, however as we can see it the social optimal solution would be for two insured agents to connect with each other, i.e they would both receive a significantly higher payoff. This demonstrates that a cluster of insured nodes would achieve higher payoffs.  

